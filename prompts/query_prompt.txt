You are a code analysis assistant.

Question: What is the code doing?

Below is relevant code and relationship information to help answer this question.

================================================================================
QUESTION
================================================================================

What is the code doing?

================================================================================
RELEVANT CODE METHODS
================================================================================
(Methods are ordered by semantic relevance to your question)
IMPORTANT: Review ALL methods below - even if a method appears later in the list, it may still be highly relevant to your question.

--- Method 1: <module> ---
File: MedSAM_Inference.py
Line: 3

Code:
File: MedSAM_Inference.py
Code:
"""
usage example:
python MedSAM_Inference.py -i assets/img_demo.png -o ./ --box "[95,255,190,350]"

"""

# %% load environment
import numpy as np
import matplotlib.pyplot as plt
import os

join = os.path.join
import torch
from segment_anything import sam_model_registry
from skimage import io, transform
import torch.nn.functional as F
import argparse


# visualization functions
# source: https://github.com/facebookresearch/segment-anything/blob/main/notebooks/predictor_example.ipynb
# change color to avoid red and green
Calls: <operator>.assignment, add_argument, eval, imsave, show_box, show_mask, show, <operator>.fieldAccess, __init__, parse_args

--- Method 2: <module> ---
File: segment_anything/predictor.py
Line: 8

Code:
File: segment_anything/predictor.py
Code:
import numpy as np
import torch

from segment_anything.modeling import Sam

from typing import Optional, Tuple

from .utils.transforms import ResizeLongestSide


Calls: <operator>.assignment

--- Method 3: getLargestCC ---
File: extensions/seg_3dnii_sparse_marker/medsam_infer_3Dbox_adrenal.py
Line: 19

Code:
Signature: getLargestCC(segmentation)
File: extensions/seg_3dnii_sparse_marker/medsam_infer_3Dbox_adrenal.py
Code:
def getLargestCC(segmentation):
    labels = measure.label(segmentation)
    largestCC = labels == np.argmax(np.bincount(labels.flat)[1:])+1
    return largestCC.astype(np.uint8)

image_size = 1024
device = torch.device("cuda:0" if torch.cuda.is_available() else "cpu")
# %%
# visualization functions
# source: https://github.com/facebookresearch/segment-anything/blob/main/notebooks/predictor_example.ipynb
# change color to avoid red and green
Calls: <operator>.assignment, label, <operator>.equals, astype, <operator>.fieldAccess, <operator>.addition, argmax, <operator>.slice, bincount

--- Method 4: dice_coefficient ---
File: comparisons/DeepLabV3+/infer_deeplabv3_res50_3D.py
Line: 94

Code:
Signature: dice_coefficient(preds, targets)
File: comparisons/DeepLabV3+/infer_deeplabv3_res50_3D.py
Code:
def dice_coefficient(preds, targets):
    smooth = 1.0
    assert preds.shape == targets.shape

    intersection = (preds * targets).sum()
    dice = (2.0 * intersection + smooth) / (preds.sum() + targets.sum() + smooth)
    return dice

Calls: <operator>.assignment, <operator>.assert, <operator>.equals, <operator>.division, <operator>.fieldAccess, sum, <operator>.addition, <operator>.multiplication

--- Method 5: _get_device ---
File: segment_anything/modeling/prompt_encoder.py
Line: 135

Code:
Signature: _get_device(self)
File: segment_anything/modeling/prompt_encoder.py
Code:
    def _get_device(self) -> torch.device:
        return self.point_embeddings[0].weight.device

Calls: <operator>.fieldAccess, <operator>.indexAccess

--- Method 6: _pe_encoding ---
File: segment_anything/modeling/prompt_encoder.py
Line: 197

Code:
Signature: _pe_encoding(self, coords: torch.py:<module>.Tensor)
File: segment_anything/modeling/prompt_encoder.py
Code:
    def _pe_encoding(self, coords: torch.Tensor) -> torch.Tensor:
        """Positionally encode points that are normalized to [0,1]."""
        # assuming coords are in [0, 1]^2 square and have d_1 x ... x d_n x 2 shape
        coords = 2 * coords - 1
        coords = coords @ self.positional_encoding_gaussian_matrix
        coords = 2 * np.pi * coords
        # outputs d_1 x ... x d_n x C shape
        return torch.cat([torch.sin(coords), torch.cos(coords)], dim=-1)

Calls: <operator>.assignment, <operator>.subtraction, <operator>.matMult, <operator>.multiplication, cat, <operator>.fieldAccess, <operator>.listLiteral, <operator>.minus, sin, cos

--- Method 7: dice_coefficient ---
File: comparisons/nnU-Net/infer_nnunet_2D.py
Line: 116

Code:
Signature: dice_coefficient(preds, targets)
File: comparisons/nnU-Net/infer_nnunet_2D.py
Code:
def dice_coefficient(preds, targets):
    smooth = 1.0
    assert preds.shape == targets.shape

    intersection = (preds * targets).sum()
    dice = (2.0 * intersection + smooth) / (preds.sum() + targets.sum() + smooth)
    return dice

# %%
predictor = nnUNetPredictor(
    tile_step_size=0.5,
    use_gaussian=True,
    use_mirroring=False, ## disable tta
    perform_everything_on_gpu=True,
    device=torch.device('cuda', 0),
    verbose=False,
    verbose_preprocessing=False,
    allow_tqdm=False
)
predictor.initialize_from_trained_model_folder(
    join(checkpoint, 'nnUNetTrainer__nnUNetPlans__2d'),
    use_folds='all',
    checkpoint_name='checkpoint_final.pth',
)

# %%
Calls: <operator>.assignment, <operator>.assert, <operator>.equals, <operator>.division, <operator>.fieldAccess, sum, <operator>.addition, <operator>.multiplication

--- Method 8: dice_coefficient ---
File: comparisons/nnU-Net/infer_nnunet_3D.py
Line: 108

Code:
Signature: dice_coefficient(preds, targets)
File: comparisons/nnU-Net/infer_nnunet_3D.py
Code:
def dice_coefficient(preds, targets):
    smooth = 1.0
    assert preds.shape == targets.shape

    intersection = (preds * targets).sum()
    dice = (2.0 * intersection + smooth) / (preds.sum() + targets.sum() + smooth)
    return dice

predictor = nnUNetPredictor(
    tile_step_size=0.5,
    use_gaussian=True,
    use_mirroring=False, ## disable tta
    perform_everything_on_gpu=True,
    device=torch.device('cuda', 0),
    verbose=False,
    verbose_preprocessing=False,
    allow_tqdm=False
)
predictor.initialize_from_trained_model_folder(
    join(checkpoint, 'nnUNetTrainer__nnUNetPlans__2d'),
    use_folds='all',
    checkpoint_name='checkpoint_final.pth',
)

# %%
Calls: <operator>.assignment, <operator>.assert, <operator>.equals, <operator>.division, <operator>.fieldAccess, sum, <operator>.addition, <operator>.multiplication

================================================================================
CODE RELATIONSHIPS
================================================================================
IMPORTANT: The relationships below show which methods call the methods above.
Pay special attention to class names and file paths in the 'Called by' section -
they often reveal the main components and algorithms in the codebase.

--- Method 1: <module> ---
Calls: add_argument, eval, imsave, show_box, show_mask, show, __init__, parse_args, to, imread

--- Method 2: <module> ---

--- Method 3: getLargestCC ---
Called by: extensions/seg_3dnii_sparse_marker/medsam_infer_3Dbox_adrenal.py:<module>
Calls: label, astype, argmax, bincount

--- Method 4: <fakeNew> ---
Called by: comparisons/DeepLabV3+/train_deeplabv3_res50.py:<module>.NpyDataset.<metaClassCallHandler>, extensions/point_prompt/train_point_prompt.py:<module>.NpyDataset.<metaClassCallHandler>, extensions/point_prompt/train_point_prompt.py:<module>.MedSAM.<metaClassCallHandler>, extensions/text_prompt/train_text_prompt.py:<module>.NpyDataset.<metaClassCallHandler>, extensions/text_prompt/train_text_prompt.py:<module>.TextPromptEncoder.<metaClassCallHandler>, extensions/text_prompt/train_text_prompt.py:<module>.MedSAM.<metaClassCallHandler>, gui.py:<module>.Window.<metaClassCallHandler>, segment_anything/automatic_mask_generator.py:<module>.SamAutomaticMaskGenerator.<metaClassCallHandler>, segment_anything/modeling/common.py:<module>.MLPBlock.<metaClassCallHandler>, segment_anything/modeling/common.py:<module>.LayerNorm2d.<metaClassCallHandler>
Calls: __init__

--- Method 5: dice_coefficient ---
Called by: comparisons/DeepLabV3+/infer_deeplabv3_res50_2D.py:<module>, comparisons/DeepLabV3+/infer_deeplabv3_res50_3D.py:<module>, comparisons/nnU-Net/infer_nnunet_2D.py:<module>, comparisons/nnU-Net/infer_nnunet_3D.py:<module>, utils/SurfaceDice.py:<module>
Calls: sum

--- Method 6: _get_device ---
Called by: extensions/text_prompt/train_text_prompt.py:<module>.TextPromptEncoder.forward, segment_anything/modeling/prompt_encoder.py:<module>.PromptEncoder.<body>, segment_anything/modeling/prompt_encoder.py:<module>.PromptEncoder.forward, segment_anything/modeling/prompt_encoder.py:<module>.PromptEncoder._get_device<metaClassAdapter>

--- Method 7: _pe_encoding ---
Called by: segment_anything/modeling/prompt_encoder.py:<module>.PositionEmbeddingRandom.<body>, segment_anything/modeling/prompt_encoder.py:<module>.PositionEmbeddingRandom.forward, segment_anything/modeling/prompt_encoder.py:<module>.PositionEmbeddingRandom.forward_with_coords, segment_anything/modeling/prompt_encoder.py:<module>.PositionEmbeddingRandom._pe_encoding<metaClassAdapter>, segment_anything/utils/onnx.py:<module>.SamOnnxModel._embed_points
Calls: cat, sin, cos

--- Method 8: dice_coefficient ---
Called by: comparisons/DeepLabV3+/infer_deeplabv3_res50_2D.py:<module>, comparisons/DeepLabV3+/infer_deeplabv3_res50_3D.py:<module>, comparisons/nnU-Net/infer_nnunet_2D.py:<module>, comparisons/nnU-Net/infer_nnunet_3D.py:<module>, utils/SurfaceDice.py:<module>
Calls: sum

================================================================================
INSTRUCTIONS
================================================================================
You are a code analysis assistant. Based on the code methods and relationships shown above, answer the following question in natural language.

IMPORTANT: Write a natural language answer. Do NOT copy or repeat:
- Method names with '--- Method X: name ---' format
- 'Called by:' or 'Calls:' lines
- Code fragments or variable names

Instead, explain what the functions do in plain English.

Question: What is the code doing?

Answer: